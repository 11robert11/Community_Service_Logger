{"changed":true,"filter":false,"title":"user.rb","tooltip":"/app/models/user.rb","value":"class User < ApplicationRecord\n    has_many :hours, dependent: :destroy\n    attr_accessor :remember_token, :activation_token, :reset_token\n    before_save :downcase_email\n    before_create :create_activation_digest\n    validates :first_name, presence: true, length: { maximum: 50}\n    validates :last_name, presence: true, length: { maximum: 50}\n    VALID_EMAIL_REGEX = /\\A[\\w+\\-.]+@[a-z\\d\\-.]+\\.[a-z]+\\z/i\n    validates :email, length: { maximum: 255}, format: { with: VALID_EMAIL_REGEX }, uniqueness: { case_sensitive: false }\n    VALID_STUDENT_ID_REGEX = /\\A[+-]?\\d+\\z/ \n    validates :student_id, presence: true, length: { minimum: 6, maximum: 6}, format: { with: VALID_STUDENT_ID_REGEX }, uniqueness: true\n    validates :grade, presence: true, :inclusion => Time.zone.now.year..Time.zone.now.year + 4\n    has_secure_password\n    validates :password, presence: true, length: { minimum: 6}, allow_nil: true\n    validates :signature, presence: false, allow_nil: true\n    #VALID_LEVEL_REGEX = /\\A[Fr,So,Ju,Se]+/\n    #validates :level, presence: true, format: {with: VALID_LEVEL_REGEX} \n   \n    # Returns the hash of a given string.\n    def User.digest(string)\n        cost = ActiveModel::SecurePassword.min_cost ? BCrypt::Engine::MIN_COST :\n                                                      BCrypt::Engine.cost\n        BCrypt::Password.create(string, cost: cost)\n    end\n    \n    # Returns a random token\n    def User.new_token\n        SecureRandom.urlsafe_base64\n    end\n    \n    \n     # Remembers a user in the database for use in persistent sessions.\n    def remember\n     self.remember_token = User.new_token\n      update_attribute(:remember_digest, User.digest(remember_token))\n    end\n    \n    # forgets a user\n    def forget\n        update_attribute(:remember_token, nil)\n    end\n    \n    # Returns true if the given token matches the digest.\n    def authenticated?(attribute, token) \n       digest = send(\"#{attribute}_digest\")\n       return false if digest.nil?\n       BCrypt::Password.new(digest).is_password?(token)\n    end\n    \n    # Activates an account\n    def activate\n        update_attribute(:activated, true)\n        update_attribute(:activated_at, Time.zone.now)\n    end\n    \n    # Sends activation email\n    def send_activation_email\n        UserMailer.account_activation(self).deliver\n    end\n    \n    \n    \n    # Sets the password reset attributes.\n    def create_reset_digest\n       self.reset_token = User.new_token\n       update_attribute(:reset_digest,  User.digest(reset_token))\n       update_attribute(:reset_sent_at, Time.zone.now)\n    end\n    \n    # Sends password reset email.\n    def send_password_reset_email\n       UserMailer.password_reset(self).deliver_now\n    end\n    \n    # Returns true if a password reset has expired.\n    def password_reset_expired?\n        reset_sent_at < 2.hours.ago\n    end\n    \n    private\n    \n    # Converts an email to all lower-case\n    def downcase_email\n        self.email = email.downcase\n    end\n    \n    # Creates and assigns the activation token and digest\n    def create_activation_digest\n        self.activation_token = User.new_token\n        self.activation_digest = User.digest(activation_token)\n    end\n    \nend","undoManager":{"mark":-2,"position":34,"stack":[[{"start":{"row":28,"column":7},"end":{"row":29,"column":0},"action":"insert","lines":["",""],"id":20},{"start":{"row":29,"column":0},"end":{"row":29,"column":4},"action":"insert","lines":["    "]},{"start":{"row":29,"column":4},"end":{"row":30,"column":0},"action":"insert","lines":["",""]},{"start":{"row":30,"column":0},"end":{"row":30,"column":4},"action":"insert","lines":["    "]},{"start":{"row":30,"column":4},"end":{"row":30,"column":5},"action":"insert","lines":["#"]}],[{"start":{"row":30,"column":5},"end":{"row":30,"column":6},"action":"insert","lines":[" "],"id":21},{"start":{"row":30,"column":6},"end":{"row":30,"column":7},"action":"insert","lines":["r"]},{"start":{"row":30,"column":7},"end":{"row":30,"column":8},"action":"insert","lines":["e"]}],[{"start":{"row":30,"column":7},"end":{"row":30,"column":8},"action":"remove","lines":["e"],"id":22},{"start":{"row":30,"column":6},"end":{"row":30,"column":7},"action":"remove","lines":["r"]}],[{"start":{"row":30,"column":6},"end":{"row":30,"column":7},"action":"insert","lines":["R"],"id":23},{"start":{"row":30,"column":7},"end":{"row":30,"column":8},"action":"insert","lines":["E"]}],[{"start":{"row":30,"column":7},"end":{"row":30,"column":8},"action":"remove","lines":["E"],"id":24}],[{"start":{"row":30,"column":7},"end":{"row":30,"column":8},"action":"insert","lines":["t"],"id":25}],[{"start":{"row":30,"column":7},"end":{"row":30,"column":8},"action":"remove","lines":["t"],"id":26}],[{"start":{"row":30,"column":7},"end":{"row":30,"column":8},"action":"insert","lines":["e"],"id":27},{"start":{"row":30,"column":8},"end":{"row":30,"column":9},"action":"insert","lines":["t"]},{"start":{"row":30,"column":9},"end":{"row":30,"column":10},"action":"insert","lines":["u"]},{"start":{"row":30,"column":10},"end":{"row":30,"column":11},"action":"insert","lines":["r"]},{"start":{"row":30,"column":11},"end":{"row":30,"column":12},"action":"insert","lines":["n"]},{"start":{"row":30,"column":12},"end":{"row":30,"column":13},"action":"insert","lines":["d"]}],[{"start":{"row":30,"column":13},"end":{"row":30,"column":14},"action":"insert","lines":[" "],"id":28}],[{"start":{"row":30,"column":13},"end":{"row":30,"column":14},"action":"remove","lines":[" "],"id":29},{"start":{"row":30,"column":12},"end":{"row":30,"column":13},"action":"remove","lines":["d"]}],[{"start":{"row":30,"column":12},"end":{"row":30,"column":13},"action":"insert","lines":["s"],"id":30}],[{"start":{"row":30,"column":13},"end":{"row":30,"column":14},"action":"insert","lines":[" "],"id":31},{"start":{"row":30,"column":14},"end":{"row":30,"column":15},"action":"insert","lines":["t"]}],[{"start":{"row":30,"column":14},"end":{"row":30,"column":15},"action":"remove","lines":["t"],"id":32}],[{"start":{"row":30,"column":14},"end":{"row":30,"column":15},"action":"insert","lines":["t"],"id":33},{"start":{"row":30,"column":15},"end":{"row":30,"column":16},"action":"insert","lines":["h"]},{"start":{"row":30,"column":16},"end":{"row":30,"column":17},"action":"insert","lines":["e"]}],[{"start":{"row":30,"column":17},"end":{"row":30,"column":18},"action":"insert","lines":[" "],"id":34},{"start":{"row":30,"column":18},"end":{"row":30,"column":19},"action":"insert","lines":["c"]},{"start":{"row":30,"column":19},"end":{"row":30,"column":20},"action":"insert","lines":["u"]},{"start":{"row":30,"column":20},"end":{"row":30,"column":21},"action":"insert","lines":["t"]},{"start":{"row":30,"column":21},"end":{"row":30,"column":22},"action":"insert","lines":["o"]},{"start":{"row":30,"column":22},"end":{"row":30,"column":23},"action":"insert","lines":["f"]}],[{"start":{"row":30,"column":23},"end":{"row":30,"column":24},"action":"insert","lines":["f"],"id":35}],[{"start":{"row":30,"column":24},"end":{"row":30,"column":25},"action":"insert","lines":[" "],"id":36}],[{"start":{"row":30,"column":24},"end":{"row":30,"column":25},"action":"remove","lines":[" "],"id":37},{"start":{"row":30,"column":23},"end":{"row":30,"column":24},"action":"remove","lines":["f"]},{"start":{"row":30,"column":22},"end":{"row":30,"column":23},"action":"remove","lines":["f"]},{"start":{"row":30,"column":21},"end":{"row":30,"column":22},"action":"remove","lines":["o"]},{"start":{"row":30,"column":20},"end":{"row":30,"column":21},"action":"remove","lines":["t"]},{"start":{"row":30,"column":19},"end":{"row":30,"column":20},"action":"remove","lines":["u"]},{"start":{"row":30,"column":18},"end":{"row":30,"column":19},"action":"remove","lines":["c"]}],[{"start":{"row":30,"column":18},"end":{"row":30,"column":19},"action":"insert","lines":["a"],"id":38},{"start":{"row":30,"column":19},"end":{"row":30,"column":20},"action":"insert","lines":["d"]},{"start":{"row":30,"column":20},"end":{"row":30,"column":21},"action":"insert","lines":["v"]},{"start":{"row":30,"column":21},"end":{"row":30,"column":22},"action":"insert","lines":["a"]},{"start":{"row":30,"column":22},"end":{"row":30,"column":23},"action":"insert","lines":["n"]},{"start":{"row":30,"column":23},"end":{"row":30,"column":24},"action":"insert","lines":["c"]},{"start":{"row":30,"column":24},"end":{"row":30,"column":25},"action":"insert","lines":["e"]}],[{"start":{"row":30,"column":25},"end":{"row":30,"column":26},"action":"insert","lines":[" "],"id":39},{"start":{"row":30,"column":26},"end":{"row":30,"column":27},"action":"insert","lines":["t"]}],[{"start":{"row":30,"column":26},"end":{"row":30,"column":27},"action":"remove","lines":["t"],"id":40}],[{"start":{"row":30,"column":26},"end":{"row":30,"column":27},"action":"insert","lines":["d"],"id":41},{"start":{"row":30,"column":27},"end":{"row":30,"column":28},"action":"insert","lines":["a"]},{"start":{"row":30,"column":28},"end":{"row":30,"column":29},"action":"insert","lines":["y"]}],[{"start":{"row":30,"column":28},"end":{"row":30,"column":29},"action":"remove","lines":["y"],"id":42}],[{"start":{"row":30,"column":28},"end":{"row":30,"column":29},"action":"insert","lines":["t"],"id":43},{"start":{"row":30,"column":29},"end":{"row":30,"column":30},"action":"insert","lines":["e"]}],[{"start":{"row":30,"column":30},"end":{"row":30,"column":31},"action":"insert","lines":[" "],"id":44},{"start":{"row":30,"column":31},"end":{"row":30,"column":32},"action":"insert","lines":["o"]},{"start":{"row":30,"column":32},"end":{"row":30,"column":33},"action":"insert","lines":["f"]}],[{"start":{"row":30,"column":33},"end":{"row":30,"column":34},"action":"insert","lines":[" "],"id":45},{"start":{"row":30,"column":34},"end":{"row":30,"column":35},"action":"insert","lines":["a"]}],[{"start":{"row":30,"column":35},"end":{"row":30,"column":36},"action":"insert","lines":[" "],"id":46},{"start":{"row":30,"column":36},"end":{"row":30,"column":37},"action":"insert","lines":["U"]},{"start":{"row":30,"column":37},"end":{"row":30,"column":38},"action":"insert","lines":["s"]},{"start":{"row":30,"column":38},"end":{"row":30,"column":39},"action":"insert","lines":["e"]},{"start":{"row":30,"column":39},"end":{"row":30,"column":40},"action":"insert","lines":["r"]}],[{"start":{"row":30,"column":40},"end":{"row":31,"column":0},"action":"insert","lines":["",""],"id":47},{"start":{"row":31,"column":0},"end":{"row":31,"column":4},"action":"insert","lines":["    "]},{"start":{"row":31,"column":4},"end":{"row":31,"column":5},"action":"insert","lines":["d"]},{"start":{"row":31,"column":5},"end":{"row":31,"column":6},"action":"insert","lines":["e"]},{"start":{"row":31,"column":6},"end":{"row":31,"column":7},"action":"insert","lines":["f"]}],[{"start":{"row":31,"column":7},"end":{"row":31,"column":8},"action":"insert","lines":[" "],"id":48}],[{"start":{"row":31,"column":8},"end":{"row":31,"column":9},"action":"insert","lines":["c"],"id":49},{"start":{"row":31,"column":9},"end":{"row":31,"column":10},"action":"insert","lines":["u"]},{"start":{"row":31,"column":10},"end":{"row":31,"column":11},"action":"insert","lines":["t"]},{"start":{"row":31,"column":11},"end":{"row":31,"column":12},"action":"insert","lines":["o"]},{"start":{"row":31,"column":12},"end":{"row":31,"column":13},"action":"insert","lines":["f"]},{"start":{"row":31,"column":13},"end":{"row":31,"column":14},"action":"insert","lines":["f"]},{"start":{"row":31,"column":14},"end":{"row":31,"column":15},"action":"insert","lines":["_"]}],[{"start":{"row":31,"column":15},"end":{"row":31,"column":16},"action":"insert","lines":["d"],"id":50},{"start":{"row":31,"column":16},"end":{"row":31,"column":17},"action":"insert","lines":["a"]},{"start":{"row":31,"column":17},"end":{"row":31,"column":18},"action":"insert","lines":["t"]},{"start":{"row":31,"column":18},"end":{"row":31,"column":19},"action":"insert","lines":["e"]}],[{"start":{"row":31,"column":19},"end":{"row":31,"column":21},"action":"insert","lines":["()"],"id":51}],[{"start":{"row":31,"column":20},"end":{"row":31,"column":21},"action":"remove","lines":[")"],"id":52},{"start":{"row":31,"column":19},"end":{"row":31,"column":20},"action":"remove","lines":["("]},{"start":{"row":31,"column":18},"end":{"row":31,"column":19},"action":"remove","lines":["e"]},{"start":{"row":31,"column":17},"end":{"row":31,"column":18},"action":"remove","lines":["t"]},{"start":{"row":31,"column":16},"end":{"row":31,"column":17},"action":"remove","lines":["a"]},{"start":{"row":31,"column":15},"end":{"row":31,"column":16},"action":"remove","lines":["d"]},{"start":{"row":31,"column":14},"end":{"row":31,"column":15},"action":"remove","lines":["_"]},{"start":{"row":31,"column":13},"end":{"row":31,"column":14},"action":"remove","lines":["f"]},{"start":{"row":31,"column":12},"end":{"row":31,"column":13},"action":"remove","lines":["f"]},{"start":{"row":31,"column":11},"end":{"row":31,"column":12},"action":"remove","lines":["o"]},{"start":{"row":31,"column":10},"end":{"row":31,"column":11},"action":"remove","lines":["t"]},{"start":{"row":31,"column":9},"end":{"row":31,"column":10},"action":"remove","lines":["u"]},{"start":{"row":31,"column":8},"end":{"row":31,"column":9},"action":"remove","lines":["c"]},{"start":{"row":31,"column":7},"end":{"row":31,"column":8},"action":"remove","lines":[" "]},{"start":{"row":31,"column":6},"end":{"row":31,"column":7},"action":"remove","lines":["f"]},{"start":{"row":31,"column":5},"end":{"row":31,"column":6},"action":"remove","lines":["e"]},{"start":{"row":31,"column":4},"end":{"row":31,"column":5},"action":"remove","lines":["d"]},{"start":{"row":31,"column":0},"end":{"row":31,"column":4},"action":"remove","lines":["    "]},{"start":{"row":30,"column":40},"end":{"row":31,"column":0},"action":"remove","lines":["",""]},{"start":{"row":30,"column":39},"end":{"row":30,"column":40},"action":"remove","lines":["r"]},{"start":{"row":30,"column":38},"end":{"row":30,"column":39},"action":"remove","lines":["e"]},{"start":{"row":30,"column":37},"end":{"row":30,"column":38},"action":"remove","lines":["s"]},{"start":{"row":30,"column":36},"end":{"row":30,"column":37},"action":"remove","lines":["U"]},{"start":{"row":30,"column":35},"end":{"row":30,"column":36},"action":"remove","lines":[" "]},{"start":{"row":30,"column":34},"end":{"row":30,"column":35},"action":"remove","lines":["a"]},{"start":{"row":30,"column":33},"end":{"row":30,"column":34},"action":"remove","lines":[" "]},{"start":{"row":30,"column":32},"end":{"row":30,"column":33},"action":"remove","lines":["f"]}],[{"start":{"row":30,"column":31},"end":{"row":30,"column":32},"action":"remove","lines":["o"],"id":53},{"start":{"row":30,"column":30},"end":{"row":30,"column":31},"action":"remove","lines":[" "]},{"start":{"row":30,"column":29},"end":{"row":30,"column":30},"action":"remove","lines":["e"]},{"start":{"row":30,"column":28},"end":{"row":30,"column":29},"action":"remove","lines":["t"]},{"start":{"row":30,"column":27},"end":{"row":30,"column":28},"action":"remove","lines":["a"]},{"start":{"row":30,"column":26},"end":{"row":30,"column":27},"action":"remove","lines":["d"]},{"start":{"row":30,"column":25},"end":{"row":30,"column":26},"action":"remove","lines":[" "]},{"start":{"row":30,"column":24},"end":{"row":30,"column":25},"action":"remove","lines":["e"]},{"start":{"row":30,"column":23},"end":{"row":30,"column":24},"action":"remove","lines":["c"]},{"start":{"row":30,"column":22},"end":{"row":30,"column":23},"action":"remove","lines":["n"]},{"start":{"row":30,"column":21},"end":{"row":30,"column":22},"action":"remove","lines":["a"]},{"start":{"row":30,"column":20},"end":{"row":30,"column":21},"action":"remove","lines":["v"]},{"start":{"row":30,"column":19},"end":{"row":30,"column":20},"action":"remove","lines":["d"]},{"start":{"row":30,"column":18},"end":{"row":30,"column":19},"action":"remove","lines":["a"]},{"start":{"row":30,"column":17},"end":{"row":30,"column":18},"action":"remove","lines":[" "]},{"start":{"row":30,"column":16},"end":{"row":30,"column":17},"action":"remove","lines":["e"]},{"start":{"row":30,"column":15},"end":{"row":30,"column":16},"action":"remove","lines":["h"]},{"start":{"row":30,"column":14},"end":{"row":30,"column":15},"action":"remove","lines":["t"]},{"start":{"row":30,"column":13},"end":{"row":30,"column":14},"action":"remove","lines":[" "]},{"start":{"row":30,"column":12},"end":{"row":30,"column":13},"action":"remove","lines":["s"]},{"start":{"row":30,"column":11},"end":{"row":30,"column":12},"action":"remove","lines":["n"]},{"start":{"row":30,"column":10},"end":{"row":30,"column":11},"action":"remove","lines":["r"]},{"start":{"row":30,"column":9},"end":{"row":30,"column":10},"action":"remove","lines":["u"]},{"start":{"row":30,"column":8},"end":{"row":30,"column":9},"action":"remove","lines":["t"]},{"start":{"row":30,"column":7},"end":{"row":30,"column":8},"action":"remove","lines":["e"]},{"start":{"row":30,"column":6},"end":{"row":30,"column":7},"action":"remove","lines":["R"]},{"start":{"row":30,"column":5},"end":{"row":30,"column":6},"action":"remove","lines":[" "]},{"start":{"row":30,"column":4},"end":{"row":30,"column":5},"action":"remove","lines":["#"]},{"start":{"row":30,"column":0},"end":{"row":30,"column":4},"action":"remove","lines":["    "]},{"start":{"row":29,"column":4},"end":{"row":30,"column":0},"action":"remove","lines":["",""]},{"start":{"row":29,"column":0},"end":{"row":29,"column":4},"action":"remove","lines":["    "]},{"start":{"row":28,"column":7},"end":{"row":29,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":28,"column":7},"end":{"row":29,"column":0},"action":"insert","lines":["",""],"id":54},{"start":{"row":29,"column":0},"end":{"row":29,"column":4},"action":"insert","lines":["    "]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":29,"column":4},"end":{"row":29,"column":4},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1563837112522}